# Fail2Ban configuration file
#
# Author: Robert Kuntz
#
#
# INFO
#
# This is a new implementation for Cloudflare wich using the list function for Cloudflare
# to work with the new free plans
#
#
# IMPORTANT
#
# Please set jail.local's permission to 640 because it contains your CF API token.
#
#
# API INFORMATIONS
#
# API Documentation: https://api.cloudflare.com/
# API: https://api.cloudflare.com/client/v4/
# To get your Cloudflare API token: https://developers.cloudflare.com/api/tokens/create/


[Definition]

# Option:  actionstart
# Notes.:  command executed on demand at the first ban (or at the start of Fail2Ban if actionstart_on_demand is set to false).
# Values:  CMD
#
actionstart = php /etc/fail2ban/action.d/cloudflare.php start

# Option:  actionstop
# Notes.:  command executed at the stop of jail (or at the end of Fail2Ban)
# Values:  CMD
#
actionstop = php /etc/fail2ban/action.d/cloudflare.php stop

# Option:  actioncheck
# Notes.:  command executed once before each actionban command
# Values:  CMD
#
actioncheck =

# Option:  actionrepair
# Notes.:  Command executed in order to restore sane environment in error case.
# Values:  CMD
actionrepair =

# Option:  actionban
# Notes.:  command executed when banning an IP. Take care that the
#          command is executed with Fail2Ban user rights.
# Tags:    <ip>  IP address
#          <failures>  number of failures
#          <time>  unix timestamp of the ban time
# Values:  CMD
actionban = php /etc/fail2ban/action.d/cloudflare.php ban <ip>

# Option:  actionunban
# Notes.:  command executed when unbanning an IP. Take care that the
#          command is executed with Fail2Ban user rights.
# Tags:    <ip>  IP address
#          <failures>  number of failures
#          <time>  unix timestamp of the ban time
# Values:  CMD
#
actionunban = php /etc/fail2ban/action.d/cloudflare.php unban <ip>


[Init]

# Declare your Cloudflare Authorization Bearer Token in the [DEFAULT] section of your jail.local file.

# Target of the firewall rule.  Default is "ip" (v4).
#
cftarget = ip

# The firewall mode Cloudflare should use.  Default is "block" (deny access).
# Consider also "js_challenge" or other "allowed_modes" if you want.
#
cfmode = block

# Option:  port
# Notes.:  specifies port to monitor
# Values:  [ NUM | STRING ]  Default:
#
port = http,https

# Option:  protocol
# Notes.:  internally used by config reader for interpolations.
# Values:  [ tcp | udp | icmp | all ] Default: tcp
#
protocol = tcp

# The message to include in the firewall IP banning rule.
#
notes = Fail2Ban <name>

[Init?family=inet6]
cftarget = ip6
