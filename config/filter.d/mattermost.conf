# Fail2Ban filter to match failed userlogin attempts as notified by mattermost's logfile
#
# Mattermost has to be configured to use timestamp at the start of the line. This is done in 'config/config.json'.
# "LogSettings -> FileJson" needs to be set to 'false'
# log lines should then look like this:
# 2019-07-09T09:29:38.836+0200  error   mlog/log.go:172 Unable to find an existing account matching your credentials. This team may require an invite from the team owner to join.      {"path": "/api/v4/users/login", "request_id": "abc123", "ip_addr": "123.123.123.123", "user_id": "", "method": "POST", "err_where": "GetUserForLogin", "http_code": 400, "err_details": ""}

[Definition]

_bypass_part = (?:"\w+"\s*:\s*(?:"[^"]*"|\S+)\s*,\s*)*
failregex = ^\s*error\s+[^\{]*\{\s*%(_bypass_part)s"ip_addr":\s*"<ADDR>"\s*,\s*%(_bypass_part)s"err_where"\s*:\s*"(?:checkUserPassword|GetUserForLogin|ValidateToken)"

ignoreregex =

# Author: Idar Lund <idarlund@gmail.com>
