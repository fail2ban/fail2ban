# Fail2Ban filter to match failed userlogin attempts as notified by mattermost's logfile
#
# Mattermost has two formats be configured in 'config/config.json'
# example loglines for both formats can be found in https://github.com/fail2ban/fail2ban/blob/0.11/fail2ban/tests/files/logs/mattermost

[Definition]

# For this one to work "LogSettings -> FileJson" needs to be set to 'false'
#_bypass_part = (?:"\w+"\s*:\s*(?:"[^"]*"|\S+)\s*,\s*)*
#failregex = ^\s*error\s+[^\{]*\{\s*%(_bypass_part)s"ip_addr":\s*"<ADDR>"\s*,\s*%(_bypass_part)s"err_where"\s*:\s*"(?:checkUserPassword|GetUserForLogin|ValidateToken)"

# For this one to work "LogSettings -> FileJson" needs to be set to 'true'
datepattern = ^\{"level"\s*:\s*"error",\s*"ts":{Epoch}\d*,
failregex = ^\s*(?:"\w+"\s*:\s*(?:"[^"]*"|\S+)\s*,\s*)*"ip_addr":\s*"<ADDR>"\s*,\s*(?:"\w+"\s*:\s*(?:"[^"]*"|\S+)\s*,\s*)*"err_where"\s*:\s*"(?:checkUserPassword|GetUserForLogin|ValidateToken)"

ignoreregex =

# Author: Idar Lund <idarlund@gmail.com>
